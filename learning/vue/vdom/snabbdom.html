<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>snabbdom更新dom</title>
</head>
<body>
  <div id="app"></div>
  <script src="../node_modules/snabbdom/build/package/init.js"></script>
  <script src="../node_modules/snabbdom/build/package/h.js"></script>
  <script>
//保存标签和逻辑的映射即view和model的对应关系
const obj = {};
//init获取patch以对比两个vdom并命令式执行dom操作
//h相当于render即只是为了返回vdom结构
const { init, h } = snabbdom;
//获取patch，根据init传入的参数获取不同平台操作dom的函数
const patch = init([snabbdom_style.default]);
//保存旧的vdom
let vnode;
//view层，执行patch进行dom更新，比对两个vdom并返回最新的vdom
function update() {
  //app.innerText=obj.foo
  //vnode = patch(vnode, h('div#app', obj.foo));
  vnode = patch(vnode, h('div#app', { style: { color: 'red' } }, obj.foo));
}
//响应式Object.defineProperty，vm层
function defineReactive(obj, key, val) {
  Object.defineProperty(obj, key, {
    get() {
      return val;
    },
    set(newVal) {
      if (newVal !== val) {
        val = newVal;
        update();
      }
    },
  });
}
//初始化
defineReactive(obj, 'foo', new Date().toLocaleString());
//执行patch
vnode = patch(app, h('div#app', obj.foo));
//model层，更新目标标签对应的逻辑
setInterval(() => {
  obj.foo = new Date().toLocaleString();
}, 1000);
  </script>
</body>
</html>